{
  "title": "Guía de Mejora de Lecciones",
  "description": "Documentación completa de los 4 tipos de mejora disponibles para lecciones existentes",
  
  "improvement_types": {
    "simplify": {
      "name": "Simplificar",
      "description": "Reduce la complejidad técnica y hace el contenido más accesible",
      "use_cases": [
        "Convertir lección Intermediate a Beginner",
        "Hacer contenido más digerible para estudiantes nuevos",
        "Reducir jerga técnica excesiva",
        "Acortar explicaciones muy detalladas"
      ],
      "changes_applied": [
        "Lenguaje más simple y directo",
        "Remover secciones muy técnicas",
        "Reducir keyPoints a 3-4 esenciales",
        "Acortar listas largas (máximo 4 ítems)",
        "Reducir tiempo estimado (~20%)",
        "Summary más conciso"
      ],
      "example_before": {
        "section_content": "## Fisiopatología de la Compliance\n\nLa compliance pulmonar (C) se define como el cambio de volumen por unidad de cambio de presión transpulmonar. Matemáticamente: C = ΔV / ΔPtp, donde Ptp = Palv - Ppl. En condiciones normales, la compliance del sistema respiratorio (Csr) resulta de la combinación en serie de la compliance pulmonar (CL) y la compliance de la pared torácica (Ccw): 1/Csr = 1/CL + 1/Ccw..."
      },
      "example_after": {
        "section_content": "## Compliance Pulmonar\n\nLa compliance es la \"elasticidad\" del pulmón. Mide qué tan fácil se expande con presión.\n\n**Fórmula simple**: C = Volumen / Presión\n\n**Valores normales**: 50-100 mL/cmH₂O\n\n**Interpretación**:\n- Alta compliance: Pulmón se expande fácilmente\n- Baja compliance: Pulmón \"rígido\", necesita más presión"
      }
    },

    "expand": {
      "name": "Expandir",
      "description": "Profundiza el contenido con más detalle técnico y explicaciones avanzadas",
      "use_cases": [
        "Convertir lección Beginner a Intermediate",
        "Agregar más profundidad para estudiantes avanzados",
        "Incluir fisiopatología detallada",
        "Agregar secciones de complicaciones, variantes, etc."
      ],
      "changes_applied": [
        "Explicaciones más detalladas y técnicas",
        "Agregar sub-secciones nuevas",
        "Incluir complicaciones del contexto",
        "Expandir keyPoints (hasta 8)",
        "Agregar secciones de contexto (escenarios, objetivos)",
        "Aumentar tiempo estimado (~30%)"
      ],
      "example_before": {
        "section_content": "## PEEP en Ventilación Mecánica\n\nPEEP mantiene presión positiva al final de la espiración.\n\n**Valores comunes**: 5-15 cmH₂O\n\n**Beneficios**:\n- Previene colapso alveolar\n- Mejora oxigenación"
      },
      "example_after": {
        "section_content": "## PEEP en Ventilación Mecánica\n\nLa PEEP (Presión Positiva al Final de la Espiración) es una presión basal que se mantiene en la vía aérea durante todo el ciclo respiratorio.\n\n### Mecanismos de Acción\n\n**1. Reclutamiento alveolar**: Mantiene abiertos alvéolos que tenderían a colapsarse al final de la espiración\n\n**2. Mejora de la CRF**: Aumenta la capacidad residual funcional, moviendo el punto de ventilación a una zona más favorable de la curva P-V\n\n**3. Reducción del shunt**: Disminuye el flujo sanguíneo a través de unidades alveolares no ventiladas\n\n**4. Prevención del atelectrauma**: Evita el colapso-reapertura cíclica que genera lesión\n\n### Valores Según Patología\n\n- **Fisiológico**: 3-5 cmH₂O (mimetiza cierre glótico)\n- **Prevención atelectasias**: 5-10 cmH₂O\n- **ARDS moderado**: 10-15 cmH₂O\n- **ARDS severo**: 15-20 cmH₂O (según tabla ARDSnet)\n\n### Complicaciones Potenciales\n\n- **Hemodinámicas**: Reducción del retorno venoso y gasto cardíaco\n- **Barotrauma**: Neumotórax si PEEP excesivo\n- **Sobredistensión**: Daño alveolar si se combina con Vt alto"
      }
    },

    "add_examples": {
      "name": "Agregar Ejemplos",
      "description": "Enriquece el contenido con casos clínicos, ejemplos numéricos y escenarios prácticos",
      "use_cases": [
        "Hacer contenido más práctico y aplicado",
        "Agregar casos clínicos del contexto",
        "Incluir cálculos numéricos paso a paso",
        "Mostrar escenarios de aplicación real"
      ],
      "changes_applied": [
        "Nueva sección de ejemplos clínicos",
        "Casos con datos de pacientes del contexto",
        "Ejemplos numéricos con cálculos",
        "Escenarios de aplicación práctica",
        "Enriquecimiento de texto existente con ejemplos",
        "Aumentar tiempo estimado (+10 min)"
      ],
      "example_before": {
        "section_content": "## Driving Pressure\n\nEl driving pressure es la diferencia entre Pplat y PEEP.\n\n**Fórmula**: ΔP = Pplat - PEEP\n\n**Objetivo**: < 15 cmH₂O"
      },
      "example_after": {
        "section_content": "## Driving Pressure\n\nEl driving pressure es la diferencia entre Pplat y PEEP.\n\n**Fórmula**: ΔP = Pplat - PEEP\n\n**Objetivo**: < 15 cmH₂O\n\n### Ejemplo Clínico 1: ARDS Moderado\n\n**Paciente**: Mujer de 65 años, peso ideal 60 kg, con ARDS por neumonía bilateral.\n\n**Configuración actual**:\n- Vt: 480 mL (8 mL/kg)\n- PEEP: 10 cmH₂O\n- Pplat: 28 cmH₂O\n\n**Cálculo**:\nΔP = 28 - 10 = **18 cmH₂O**\n\n**Interpretación**: Driving pressure de 18 cmH₂O está por encima del objetivo < 15 cmH₂O, aumentando riesgo de VILI.\n\n**Acción**:\n1. Reducir Vt a 360 mL (6 mL/kg peso ideal)\n2. Re-medir Pplat → esperamos ~22 cmH₂O\n3. Nuevo ΔP = 22 - 10 = 12 cmH₂O ✓\n\n### Ejemplo Clínico 2: Ajuste de PEEP\n\n**Paciente**: Hombre de 80 kg (peso ideal 75 kg) con ARDS severo.\n\n**Escenario A** (PEEP bajo):\n- Vt: 450 mL (6 mL/kg), PEEP: 8 cmH₂O, Pplat: 26 cmH₂O\n- ΔP = 26 - 8 = **18 cmH₂O** (alto)\n\n**Escenario B** (PEEP optimizado):\n- Vt: 450 mL, PEEP: 14 cmH₂O, Pplat: 27 cmH₂O\n- ΔP = 27 - 14 = **13 cmH₂O** (óptimo)\n\n**Conclusión**: Aunque Pplat aumentó ligeramente, el driving pressure mejoró significativamente, indicando mejor compliance por reclutamiento alveolar."
      }
    },

    "update_references": {
      "name": "Actualizar Referencias",
      "description": "Actualiza la bibliografía con referencias nuevas del contexto",
      "use_cases": [
        "Agregar estudios más recientes",
        "Incluir guías clínicas actualizadas",
        "Combinar referencias de múltiples fuentes",
        "Marcar referencias faltantes"
      ],
      "changes_applied": [
        "Agregar referencias nuevas del contexto",
        "Combinar con referencias existentes",
        "Eliminar duplicados",
        "Mantener existentes si no hay nuevas",
        "Marcar [[MISSING_REF]] si no disponibles"
      ],
      "example_before": {
        "references": [
          "West, J.B. (2012). Respiratory Physiology: The Essentials. 9th Edition."
        ]
      },
      "example_after_with_context": {
        "contextSnippet": {
          "references": [
            "Amato, M.B. et al. (2015). Driving pressure and survival in ARDS. NEJM 372:747-755",
            "Guérin, C. et al. (2013). Prone positioning in severe ARDS. NEJM 368:2159-2168"
          ]
        },
        "references": [
          "West, J.B. (2012). Respiratory Physiology: The Essentials. 9th Edition.",
          "Amato, M.B. et al. (2015). Driving pressure and survival in ARDS. NEJM 372:747-755",
          "Guérin, C. et al. (2013). Prone positioning in severe ARDS. NEJM 368:2159-2168"
        ]
      },
      "example_after_without_context": {
        "contextSnippet": {
          "references": []
        },
        "references": [
          "West, J.B. (2012). Respiratory Physiology: The Essentials. 9th Edition.",
          "[[MISSING_REF]]"
        ]
      }
    }
  },

  "api_endpoints": {
    "improve_only": {
      "method": "POST",
      "path": "/api/lessons/:id/improve",
      "description": "Mejora la lección sin guardar, retorna contenido mejorado",
      "auth": "Bearer token (TEACHER o ADMIN)",
      "request_body": {
        "improvementType": "simplify | expand | add_examples | update_references",
        "contextSnippet": {
          "keyPoints": ["..."],
          "parameters": {},
          "references": ["..."],
          "clinicalScenarios": ["..."],
          "patientData": {},
          "complications": ["..."]
        }
      },
      "response": {
        "success": true,
        "data": {
          "improvedContent": {},
          "improvementType": "expand",
          "warnings": ["..."],
          "stats": {
            "originalTime": 35,
            "improvedTime": 45,
            "originalSections": 6,
            "improvedSections": 8
          }
        }
      }
    },

    "improve_and_save": {
      "method": "POST",
      "path": "/api/lessons/:id/improve-and-save",
      "description": "Mejora la lección y la guarda en base de datos",
      "auth": "Bearer token (TEACHER o ADMIN)",
      "request_body": {
        "improvementType": "simplify | expand | add_examples | update_references",
        "contextSnippet": {}
      },
      "response": {
        "success": true,
        "data": {
          "lesson": {},
          "improvementType": "expand",
          "warnings": ["..."],
          "stats": {}
        }
      }
    }
  },

  "usage_examples": [
    {
      "scenario": "Simplificar lección de ARDS para estudiantes nuevos",
      "request": {
        "improvementType": "simplify",
        "contextSnippet": {
          "level": "Beginner",
          "keyPoints": [
            "ARDS es síndrome de insuficiencia respiratoria aguda",
            "Se caracteriza por hipoxemia severa",
            "Requiere ventilación mecánica protectora"
          ]
        }
      },
      "expected_changes": [
        "Reducción de complejidad técnica",
        "Lenguaje más accesible",
        "3-4 keyPoints esenciales",
        "Tiempo reducido 20%"
      ]
    },
    {
      "scenario": "Expandir lección básica de compliance a nivel intermedio",
      "request": {
        "improvementType": "expand",
        "contextSnippet": {
          "level": "Intermediate",
          "keyPoints": ["..."],
          "complications": [
            "Baja compliance en ARDS",
            "Alta compliance en enfisema"
          ],
          "clinicalScenarios": [
            "Ajuste de Vt según compliance",
            "Interpretación de curva P-V"
          ]
        }
      },
      "expected_changes": [
        "Más detalle técnico",
        "Secciones de complicaciones agregadas",
        "Escenarios clínicos incluidos",
        "Tiempo aumentado 30%"
      ]
    },
    {
      "scenario": "Agregar ejemplos numéricos a lección de driving pressure",
      "request": {
        "improvementType": "add_examples",
        "contextSnippet": {
          "patientData": {
            "age": 65,
            "weight": 75,
            "diagnosis": "ARDS moderado",
            "Pplat": 28,
            "PEEP": 10,
            "Vt": 480
          },
          "clinicalScenarios": [
            "Reducir Vt para optimizar driving pressure",
            "Ajustar PEEP según tabla ARDSnet"
          ]
        }
      },
      "expected_changes": [
        "Nueva sección de ejemplos clínicos",
        "Cálculos paso a paso con datos reales",
        "Interpretación de resultados",
        "Tiempo aumentado +10 min"
      ]
    },
    {
      "scenario": "Actualizar referencias con estudios recientes",
      "request": {
        "improvementType": "update_references",
        "contextSnippet": {
          "references": [
            "Amato, M.B. et al. (2015). Driving pressure and survival in ARDS. NEJM",
            "Guérin, C. et al. (2013). Prone positioning in severe ARDS. NEJM",
            "Fan, E. et al. (2017). An Official ATS/ERS/ESICM Clinical Practice Guideline"
          ]
        }
      },
      "expected_changes": [
        "Referencias nuevas agregadas",
        "Referencias existentes preservadas",
        "Duplicados eliminados",
        "Total: referencias originales + nuevas del contexto"
      ]
    }
  ],

  "rules_and_constraints": [
    "Solo usar información del contextSnippet proporcionado",
    "NO inventar datos clínicos, valores, protocolos o referencias",
    "Conservar estructura original (title, summary, sections, keyPoints, references)",
    "Mantener orden consecutivo en sections (1, 2, 3...)",
    "Usar [[MISSING]] para datos faltantes",
    "Usar [[MISSING_REF]] si no hay referencias nuevas disponibles",
    "Mantener coherencia entre dificultad y nivel de detalle",
    "Respetar límites: estimatedTime 5-60, summary 30-300 caracteres"
  ],

  "best_practices": [
    "Proporcionar contextSnippet rico con toda la información disponible",
    "Usar 'simplify' para adaptar a audiencias menos técnicas",
    "Usar 'expand' cuando estudiantes necesitan más profundidad",
    "Usar 'add_examples' para hacer contenido más aplicado y práctico",
    "Usar 'update_references' cuando hay nueva evidencia disponible",
    "Revisar warnings para identificar información faltante",
    "Verificar stats para confirmar cambios esperados"
  ]
}

